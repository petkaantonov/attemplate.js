<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<html>
    <head>
        <meta http-equiv="content-type" content="text/php; charset=utf-8" />
        <title>Attemplate.js tests</title>
        <script src="../attemplate.js" type="text/javascript"></script>
    </head>
    <body>
        <script type="asd">
            <select>
            @foreach( options ) {
                <option value="@value" @if( selected ) { selected }>
                    
                </option>
            }
            </select>
        </script>
        
        <script>
            var tem = [].map.call( document.querySelectorAll("[type=asd]"), function(t){
                return t.innerHTML;
            });
        </script>
    
    
        <script type="text/html" id="export-test">
        @export as recipeTemplate
        
        <ul>
        @foreach( recipe in recipes ) {
            <li>Ingredients for @recipe.name:</li>
            <li>
                <ul>
                    @foreach( ingredient in recipe.ingredients ) {
                        <li>@ingredient</li>
                    }
                </ul>
            </li>
        }
        </ul>
        
        </script>    
        <script type="text/javascript">

            template.getById( "export-test" ); //trigger the export
        
            function throwError() {
                throw "Assertion failed";
            }
        
            var templates = [
                '<div class="@divClass">@message</div>',
                '<div>@( true ? "yes" : "no")</div>',
                '@{ var hello = "hello world"; } <div>@hello</div>',
                '@if( true ) {<div>True</div>}else if( file_not_found ) {    <div>File not found</div>   }else {    <div>False</div>}',
                '@if( !loggedin ) {<div>You are not logged in</div>}',
                '<ul>@foreach( item in arr ) {<li>@index: @item</li>}</ul>',
                '@for( item in |1->10| ) {@if( true ) {<div>lonely div</div>@break}}',
                '<div>@day.@month.@year</div>',
                '<ul>@foreach( recipe in recipes ) { <li>Ingredients for @recipe.name:</li> <li> <ul> @foreach( ingredient in recipe.ingredients ) { <li>@ingredient</li> } </ul> </li>}</ul>',
                '@helper myHelper( arg1, arg2 ) { <div>@((Math.round( (arg1 + arg2 ) *100000000) /100000000).toFixed(2))</div> } <ul> @foreach( number in numbers ) { <li>@myHelper(number, number)</li> } </ul>',
                '@import recipeTemplate as recipeHelper <div>@recipeHelper()</div>',
                '<a href="@data"></a>'
            ];
            


                    
            var templatesData = [
                {
                    divClass: "classyClass",
                    message: "Hello world"
                }, {}, {}, {}, {},
                {
                    arr: [1,2,3]
                }, {},
                {
                    day: 16,
                    month: 5,
                    year: 2012
                },
                {
                    recipes: [
                        {
                            name: "wtf",
                            ingredients: [
                                "why",
                                "would",
                                "I"
                            ]
                        },
                        {
                            name: "I don't know anything",
                            ingredients: [
                                "make an example",
                                "with recipes"
                            ]
                        },
                        {
                            name: "About recipes",
                            ingredients: [
                                "If i don't know anything",
                                "about them"                                                   
                            ]
                        },
                    
                    ]
                    
                    
                },
                
                {
                    numbers: [
                        1,
                        2.34,
                        5.1,
                        6
                    ]
                },
                {
                    recipes: [
                        {
                            name: "wtf",
                            ingredients: [
                                "why",
                                "would",
                                "I"
                            ]
                        },
                        {
                            name: "I don't know anything",
                            ingredients: [
                                "make an example",
                                "with recipes"
                            ]
                        },
                        {
                            name: "About recipes",
                            ingredients: [
                                "If i don't know anything",
                                "about them"                                                   
                            ]
                        },

                    ]


                }
                
            ];
            
            var expected = [
                '<div class="classyClass">Hello world</div>',
                '<div>yes</div>',
                ' <div>hello world</div>',
                '<div>True</div>',
                '<div>You are not logged in</div>',
                '<ul><li>0: 1</li><li>1: 2</li><li>2: 3</li></ul>',
                '<div>lonely div</div>',
                '<div>16.5.2012</div>',
                '<ul><li>Ingredients for wtf:</li> <li> <ul> <li>why</li><li>would</li><li>I</li> </ul> </li><li>Ingredients for I don\'t know anything:</li> <li> <ul> <li>make an example</li><li>with recipes</li> </ul> </li><li>Ingredients for About recipes:</li> <li> <ul> <li>If i don\'t know anything</li><li>about them</li> </ul> </li></ul>',
                ' <ul><li><div>2.00</div></li><li><div>4.68</div></li><li><div>10.20</div></li><li><div>12.00</div></li> </ul>',
                
                
                    '<div><ul><li>Ingredients for wtf:</li>\n'+
                    '<li>\n'+
                    '<ul>\n'+
                    '<li>why</li><li>would</li><li>I</li>\n'+
                    '</ul>\n'+
                    '</li><li>Ingredients for I don\'t know anything:</li>\n'+
                    '<li>\n'+
                    '<ul>\n'+
                    '<li>make an example</li><li>with recipes</li>\n'+
                    '</ul>\n'+
                    '</li><li>Ingredients for About recipes:</li>\n'+
                    '<li>\n'+
                    '<ul>\n'+
                    '<li>If i don\'t know anything</li><li>about them</li>\n'+
                    '</ul>\n'+
                    '</li>\n'+
                    '</ul>\n'+
                    '</div>'
                
            ];
            
            templates.forEach( function( str, index ) {
                var tmpl = template.fromString(str),
                    given = tmpl( templatesData[index] ),
                    expect = expected[index];
                
                if( given !== expect ) {
                    console.log( "Expecting", expect, "Given", given );
                    throwError();
                }
            
            });
            
        </script>
    </body>
    
</html>
    